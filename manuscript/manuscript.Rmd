---
title: "Beneficial arthropod habitat useage changes within-season: implications for pest control services in croplands"
#Potential titles: 
# Non-crop features influence the abundance and timing of beneficial arthropod abundance
# 1) Cropland ecosystem services in space and time: Beneficial arthropod habitat use shifts within-season.
# 2) Beneficial arthropod habitat use shifts within-season: implications for pest control services in croplands
# 
author:
  - name: Samuel Robinson
    email: samuel.robinson@ucalgary.ca
    affiliation: University of Calgary
    footnote: 1
  - name: Diane Edwards
    email: diane.edwards.ca@gmail.com
    affiliation: Ambrose University
  - name: Jess Vickruck
    email: jessica.vickruck@canada.ca
    affiliation: University of Calgary
  - name: Lincoln Best
    email: lincoln.best@oregonstate.edu
    affiliation: Oregon State University
  - name: Paul Galpern
    email: paul.galpern@ucalgary.ca
    affiliation: University of Calgary
address:
  - code: University of Calgary
    address: 2500 University Drive NW, Calgary, AB, Canada
  - code: Ambrose University
    address: 150 Ambrose Circle SW, Calgary, AB
  - code: Oregon State University
    address: 1500 SW Jefferson Way, Corvallis, OR, USA
footnote:
  - code: 1
    text: "Corresponding Author"
date: "Spring 2020"
abstract: "Ground-dwelling arthropods are important generalist predators in agro-ecosystems, and can use non-crop features as overwintering habitats. However, it is unclear which types of landscape features constitute useful non-crop habitat, and at what spatial scale organisms gather resources at. Additionally, the same landscape feature may act as source of arthropods spillover at different times of the year, but this is rarely considered. We modeled the activity-density of four highly-abundant species of Canadian prairie arthropods, and used functional regression to simultaneously consider both their habitat preferences and the timing of sources and sinks. _Pterostichus melanarius_ (Coleoptera: Carabidae) and _Pardosa moesta_ (Arachnida: Lycosidae) appear to be attracted to canola (_Brassica napus_ L.) during the early summer, then disperse to grasslands, wetlands, and grassy road margins during the end of the summer. This suggests that grasslands and wetlands act as reservoir habitats for predatory arthropods, and that farmers should consider preserving existing habitat around croplands in order to maintain background levels of pest-control."

bibliography: refs.bib
csl: ecology-letters.csl
geometry: "left=3cm,right=3cm,top=3cm,bottom=3cm"
output: 
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
    toc: false
    fig_caption: true
header-includes: 
  \usepackage{float} \floatplacement{figure}{H} 
  \newcommand{\beginsupplement}{\setcounter{table}{0} \newpage \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
  \usepackage{setspace}
  \linenumbers
---

<!-- This argument in YAML header adds "manuscript_appendix.md" after document -->
<!-- output: -->
<!--   bookdown::html_document2: -->
<!--     pandoc_args: ["--include-after-body=manuscript_appendix.md"] -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(tidyverse)
library(mgcv)

#Load models
load('../data/PteMelMod.Rdata')
load('../data/ParDisMod.Rdata')
load('../data/ParMoeMod.Rdata')
load('../data/OpilioMod.Rdata')

source('../helperFunctions.R') #Load helper functions

#Forces numbers displayed in inline hooks to be rounded
inline_hook <- function(x) {
  if (is.numeric(x)) {
    format(x, digits = 2)
  } else x
}
knitr::knit_hooks$set(inline = inline_hook)

#Get landscape % cover for each cover class
coverList <- PteMelMod$datList[9:25]
siteID <- as.numeric(rownames(unique(cbind(PteMelMod$datList$E,PteMelMod$datList$N))))
coverList <- lapply(coverList,function(x){
  data.frame(site=as.character(siteID),x[siteID,]) %>%  #Get unique sites only, convert to DF
  pivot_longer(cols=d30:d1500,names_to='dist',values_to='prop') %>% 
  mutate(dist=as.numeric(gsub('d','',dist)))
})
coverList <- data.frame(cover=rep(names(coverList),each=nrow(coverList[[1]])),do.call('rbind',coverList))


#Calculate marginal and conditional R2 (Nakagawa and Schielzeth 2013)

#Overall R2 (conditional/marginal)
r2Nakagawa <- sapply(list(PteMelMod=PteMelMod,ParDisMod=ParDisMod,ParMoeMod=ParMoeMod,OpilioMod=OpilioMod), function(modList){
  with(modList,getR2Terms(mod3,intVal=exp(mod1$coefficients[[1]]),thetaVal=mod1$family$getTheta(TRUE)))
}) %>% round(.,3) %>% as.data.frame()

#Piecewise R2
r2Nakagawa2 <- lapply(list(PteMelMod=PteMelMod,ParDisMod=ParDisMod,ParMoeMod=ParMoeMod,OpilioMod=OpilioMod), function(modList){
  with(modList,getR2Terms(mod3,intVal=exp(mod1$coefficients[[1]]),thetaVal=mod1$family$getTheta(TRUE),individual=TRUE)) %>%
    mutate(fixed=!grepl('(day|E,N|sigmaD)',terms),random=grepl('(day|E,N)',terms)) %>% 
    mutate(r2comp=round(var/sum(var),4))
}) %>% do.call('rbind',.) %>% rownames_to_column('model') %>% mutate(model=gsub('.[0-9]{1,2}','',model))

#Extract Pterostichus melanarius results
pmelRes <- summary(PteMelMod$mod3)
pmelLinTerms <- pmelRes$p.table %>% as.data.frame() %>% 
  rownames_to_column('loc') %>% 
  mutate(loc=gsub('trapLoc','',loc)) %>% 
  mutate(loc=gsub('ditch','road margin',loc),loc=gsub('native','grassland',loc),loc=firstUpper(gsub('pivot','field edge',loc))) %>%
  rename(p='Pr(>|z|)') %>% mutate(p=roundLess(p,3)) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold

pmelSmTerms <- pmelRes$s.table %>% as.data.frame() %>% 
  rownames_to_column('Smoother') %>% 
  mutate(Smoother=gsub('distMat','Distance',Smoother),Smoother=gsub('endDayMat','Day',Smoother),Smoother=gsub('day','Day',Smoother)) %>%
  mutate(Smoother=gsub('GrassWetland','Grassland',Smoother),Smoother=gsub('TreeShrub','Woodland',Smoother)) %>% 
  rename(p='p-value') %>% mutate(p=roundLess(p,3)) %>% mutate_at(vars(2:4),roundLess,dig=2) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold

#Extract Pardosa distincta results
pdisRes <- summary(ParDisMod$mod3)
pdisLinTerms <- pdisRes$p.table %>% as.data.frame() %>% 
  rownames_to_column('loc') %>% 
  mutate(loc=gsub('trapLoc','',loc)) %>% 
  mutate(loc=gsub('ditch','road margin',loc),loc=gsub('native','grassland',loc),loc=firstUpper(gsub('pivot','field edge',loc))) %>%
  rename(p='Pr(>|z|)') %>% mutate(p=roundLess(p,3)) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold
pdisSmTerms <- pdisRes$s.table %>% as.data.frame() %>% 
  rownames_to_column('Smoother') %>% 
  mutate(Smoother=gsub('distMat','Distance',Smoother),Smoother=gsub('endDayMat','Day',Smoother),Smoother=gsub('day','Day',Smoother)) %>% 
  mutate(Smoother=gsub('GrassWetland','Grassland',Smoother),Smoother=gsub('TreeShrub','Woodland',Smoother)) %>% 
  rename(p='p-value') %>% mutate(p=roundLess(p,3)) %>% mutate_at(vars(2:4),roundLess,dig=2) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold

#Extract Pardosa moesta results
pmoeRes <- summary(ParMoeMod$mod3)
pmoeLinTerms <- pmoeRes$p.table %>% as.data.frame() %>% 
  rownames_to_column('loc') %>% 
  mutate(loc=gsub('trapLoc','',loc)) %>% 
  mutate(loc=gsub('ditch','road margin',loc),loc=gsub('native','grassland',loc),loc=firstUpper(gsub('pivot','field edge',loc))) %>%
  rename(p='Pr(>|z|)') %>% mutate(p=roundLess(p,3)) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold
pmoeSmTerms <- pmoeRes$s.table %>% as.data.frame() %>% 
  rownames_to_column('Smoother') %>% 
  mutate(Smoother=gsub('distMat','Distance',Smoother),Smoother=gsub('endDayMat','Day',Smoother),Smoother=gsub('day','Day',Smoother)) %>% 
  mutate(Smoother=gsub('GrassWetland','Grassland',Smoother),Smoother=gsub('TreeShrub','Woodland',Smoother)) %>% 
  rename(p='p-value') %>% mutate(p=roundLess(p,3)) %>% mutate_at(vars(2:4),roundLess,dig=2) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold

#Extract Phalangium opilio results
opilRes <- summary(OpilioMod$mod3)
opilLinTerms <- opilRes$p.table %>% as.data.frame() %>% 
  rownames_to_column('loc') %>% 
  mutate(loc=gsub('trapLoc','',loc)) %>% 
  mutate(loc=gsub('ditch','road margin',loc),loc=gsub('native','grassland',loc),loc=firstUpper(gsub('pivot','field edge',loc))) %>%
  rename(p='Pr(>|z|)') %>% mutate(p=roundLess(p,3)) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold
opilSmTerms <- opilRes$s.table %>% as.data.frame() %>% 
  rownames_to_column('Smoother') %>% 
  mutate(Smoother=gsub('distMat','Distance',Smoother),Smoother=gsub('endDayMat','Day',Smoother),Smoother=gsub('day','Day',Smoother)) %>% 
  mutate(Smoother=gsub('GrassWetland','Grassland',Smoother),Smoother=gsub('TreeShrub','Woodland',Smoother)) %>% 
  rename(p='p-value') %>% mutate(p=roundLess(p,3)) %>% mutate_at(vars(2:4),roundLess,dig=2) %>% 
  mutate(sig=is.na(as.numeric(p))|as.numeric(p)<0.05) %>% #If p<0.05
  mutate(pTable=ifelse(sig,boldLaTeX(p),p)) %>% select(-sig) #Make text bold

# #Extract concurvity from PteMel model
# mod3concurv <- concurvity(PteMelMod$mod3,FALSE)$estimate

#Get variance components
varComp <- rownames_to_column(data.frame(gam.vcomp(PteMelMod$mod3),spp='Pterostichus melanarius'),'term') %>% 
  bind_rows(rownames_to_column(data.frame(gam.vcomp(ParDisMod$mod3),spp='Pardosa distincta'),'term')) %>% 
  bind_rows(rownames_to_column(data.frame(gam.vcomp(OpilioMod$mod3),spp='Phalangium opilio'),'term')) %>%
  mutate(term=factor(term,levels=names(PteMelMod$mod3$sp)))

#Get number of traps in each location
NtrapsPer <- select(PteMelMod$tempTrap,ID,trapLoc,distFrom) %>% data.frame() %>% distinct() %>% group_by(trapLoc) %>% summarize(n=n())

#Get average catch rates per spp
Ncatches <- lapply(list(PteMelMod,ParDisMod,ParMoeMod,OpilioMod),function(x){
  with(data.frame(x$datList), data.frame(perDayMean=mean(count/trapdays),perDayMedian=median(count/trapdays),total=sum(count),perDaySD=sd(count/trapdays)))
}) %>% do.call('rbind',.) %>% mutate(spp=c('PteMel','ParDis','ParMoe','Opilio'))


```

\newpage
\doublespacing

# Introduction
Arthropods are one of the most influential groups of animals in agricultural systems.
Pest arthropods can cause large reductions in crop yield [@oerke2005], which can result in negative downstream economic effects and food insecurity.
On the other hand, spillover of beneficial arthropods from adjacent non-crop patches can deliver increased crop yields by providing ecosystem services such as extra pollination or pest suppression [@losey2006; @klein2007; @garibaldi2013].
Seasonal "pulses" of food resources from crop fields act as a bottom-up driver of their associated arthropod communities, meaning that agricultural land can act as a source of nutrients and individuals for adjacent non-crop land [@diekotter2010; @galpern2017].
These important fluxes of mobile arthropods, both to crops and away from them, are key for managing both crop yield and biodiversity in agroecosystems.
Finding "win-win" practices is of particular importance to land managers and conservationists; that is, practices that result in better conservation outcomes while maintaining or improving crop yields.
Finally, agricultural land occupies 15 million km$^2$ (~36%) of land globally [@ramankutty2018], suggesting that there remains great potential to achieve conservation outcomes by adjusting agricultural practices.

Uncultivated semi-natural land (SNL) can act as important habitat for beneficial arthropods [@duelli2003], which may spill over into adjacent cropland.
Therefore, landscape management is a strategy to increase beneficial arthropod abundance in crops [@albrecht2010; @landis2000; @martin2020; but see @tscharntke2016; @karp2018].
For example, wild bee abundance in agricultural landscapes is largely driven by flower and nest availability [@roulston2011], and the effect of SNL on bee abundance and diversity is generally positive.
Predatory arthropods such as beetles or spiders can be limited by water, food, and egg-laying sites [@lovei1996; @purtauf2005; @gardiner2010], but the effect of SNL on their abundance and diversity is less consistent [@macfadyen2013; @shackelford2013] as some taxa may use SNL as a travel corridor or overwintering site, but are not completely dependent on it for reproduction.
Some taxa are not dependent on SNL at all, and thrive in cultivated landscapes, while others exclusively inhabit SNL and do not venture beyond the edge of cultivated fields.
For example, carabid beetles are thought to reproduce in field margins, while the adults feed in fields [@desender1988].
This depends on the life history of the organisms in question, such as the seasonal timing of emergence, feeding, and reproduction, as well as their traits such as dispersal capability.
Non-adjacent cropland can also influence arthropod abundance if the organisms are long-distance dispersers [@oberg2008].
<!-- Small patches of SNL can have a large effect if overall landscape lacks SNL (landscape contrast [@boetzl2020; @vanSchalkwyk2020]) -->
In this way, the spillover of beneficial arthropods into crops depends not only on the amount of adjacent SNL, but the specific habitat type, the time of the year, and the spatial scale at which an organism gathers resources.

Despite what is known about the spatial and temporal aspects of beneficial arthropod spillover, these are rarely considered together.
First, some non-crop habitat may act as sources of arthropods during some times of the year, but as sinks during other times, meaning that the timing of spillover from non-crop habitat may not align with important periods in crop development.
Arthropods can migrate from managed crops back into adjacent SNL at the end of the season [@desender1988; @tscharntke2005b], but this is seldom considered.
Second, the spatial "grain" of the landscape that is relevant to an organism depends on their traits and life history [@ahrenfeldt2015].
For instance, bumblebee abundance can be controlled by both nearby and far-away SNL abundance [@westphal2006], but this is poorly studied for other groups of beneficial organisms [but see @sander2006].
Finally, the feeding and life-history characteristics of many predatory ground beetles and spiders are often poorly-documented, especially in North America.
This makes it difficult to make generalizations of which habitat types harbour beneficial arthropods, making it even more difficult to provide accurate information to farmers about land management practices.

In this study, we used pitfall traps to determine how landscape composition affects the seasonal activity-density of arthropods across a large Canadian prairie agroecosystem.
We considered the following hypotheses:
1. Untilled semi-natural land provides egg-laying and feeding areas for predatory arthropods, meaning that it should act as a source of arthropods during the early part of the season, and a sink during the later part of the season. 
2. Crops act as sources of food (pest insects) for predatory arthropods during the growing season. This should result in agricultural land becoming a sink for predators in the early part of the season as they migrate into the crop, and a source at the end of the season as they migrate out of the crop.
3. Crops may act as a temporary feeding site for predators. Therefore, crops may act as a local sink for arthropods, but will also be negatively associated at larger (landscape-level) scales.
Using a large pitfall trapping dataset, we related seasonal changes in arthropod abundance to landscape composition at multiple spatial scales.

# Methods

## Data collection
We used a set of `r sum(NtrapsPer$n)` pitfall traps installed in road margins (minimum of 5 m away from the road edge, `r with(NtrapsPer, sum(n[trapLoc=='ditch']))` traps) and in-field locations (`r with(NtrapsPer, sum(n[trapLoc!='ditch']))`) across southern Alberta, Canada in 2017 (Figure \@ref(fig:siteMap)).
The sites spanned a west-to-east gradient of four natural subregions, including foothills parkland, foothills fescue, mixedgrass, and dry mixedgrass [@ABRegions2006].
Traps were placed starting on `r format(as.Date(as.character(min(PteMelMod$tempTrap$startjulian)),format='%j'),format='%B %d')`, and collections ended on `r format(as.Date(as.character(max(PteMelMod$tempTrap$endjulian)),format='%j'),format='%B %d')`, with collection occurring continuously and traps being emptied every `r round(mean(PteMelMod$tempTrap$trapdays),1)` days on average (SD: `r round(sd(PteMelMod$tempTrap$trapdays),1)`). 
This resulted in `r nrow(PteMelMod$tempTrap)` unique collection events, taking place across a total of `r round(sum(PteMelMod$tempTrap$trapdays),1)` trapping days.
In-field traps were placed in canola crops (`r with(NtrapsPer, sum(n[trapLoc=='canola']))`), wetlands (`r with(NtrapsPer, sum(n[trapLoc=='wetland']))`), grassy field edges (`r with(NtrapsPer, sum(n[trapLoc=='pivot']))`), and remnant prairie grasslands (`r with(NtrapsPer, sum(n[trapLoc=='native']))`).
Traps in canola were installed at 25, 75, and 200 m along a transect heading away from the nearest non-crop feature (wetland, grassy field edges, or remnant prairie), while the trap at 0 m was installed in the non-crop feature itself.
We used 582 mL Solo® cups buried up to the rim and partially filled with ethylene glycol, with 2 cm wire mesh mounted over the rim to prevent vertebrates from falling into the traps.
Specimens were identified to species using appropriate taxonomic literature [@dondale1990; @edgar1990; @vogel2004; @yigit2007].

We used counts of organisms in our pitfall traps as proxies of ecosystem service provision.
However, increased counts of organisms in pitfall traps can represent higher activity levels (same number of organisms but more mobile) or higher abundances in the vicinity of the trap.
This makes it impossible to disentangle arthropod activity from density using single traps [@lang2000; @zhao2013], meaning that counts in the traps represent the "activity-density" of a given organism.
Despite this disadvantage, activity-density is generally positively related to ecosystem services, at least in carabids [@trichard2014; @boetzl2018; @gonzalez2020], making it acceptable for our study.

```{r siteMap, echo=FALSE, fig.cap='Location of pitfall traps during 2017, and classified cover f. Inset map shows study location within Alberta. Roadside traps were installed in road margins, while in-field traps were installed directly in canola fields or in adjacent wetland or grassy field edges.', out.width='100%'}  
  include_graphics('../figures/maps/PF2017Map.png',dpi=NA)
```
  
We used four highly-abundant species of predatory arthropods found in the pitfall traps, as common species are often more important for ecosystem service provision than rare species [@winfree2015], but their habitat preferences are still poorly understood.
_Pterostichus melanarius_ is an introduced predatory ground beetle (Coleoptera: Carabidae) that is a wide-ranging generalist known to prey upon crop pests [@carcamo1994; @larsen2003; @busch_Msc].
It is commonly found in untilled grasslands [@purtauf2005] and may use grassy field edges as larval habitat [@desender1988].
_Pardosa_ are wolf spiders (Araneae: Lycosidae) that use an active wandering predation strategy [@young1990], and are common across the Canadian prairies.
Both _Pardosa distincta_ and _Pardosa moesta_ are found in a wide variety of habitats, but are common in ungrazed pastures [@dondale1990; @carcamo2014].
_P. distincta_ is also commonly found in disturbed environments [@collins1996; @wade2010], while _P. moesta_ appear to prefer less frequent disturbances [@graham2003; @kowal2011; but see @dondale1990].
Other _Pardosa_ are known to use road margins and wooded areas as habitat [@buddle2000; @drapela2011].
Finally, _Phallangium opilio_ is an introduced harvestman (Opiliones: Phalangiidae) that is found in drier disturbed areas [@bragg2009].
Juveniles hatch from eggs during the spring, becoming adults during the summer, and eggs are laid during the fall [adults do not overwinter; @bragg2009].
They are commonly found in human-altered landscapes [@muster2014; @vandepoel2015Msc] and are nocturnal generalist hunters and scavengers [@halaj2000; @allard2005; @allard2005b], mainly eating small soft-bodied invertebrates [@acosta2007].

To characterize landscape composition surrounding the traps, we used publicly available classified landscape data [30 m resolution; @AAFC_data].
AAFC cropland landscape classifications from 2017 were very accurate for cultivated fields (~90%), but were less accurate for non-crop areas (~70%).
We combined functionally similar landscape categories (cereals: _Triticum aestivum_ and _Hordeum vulgare_, pulses: _Pisum sativum_ and _Lens culinaris_, forest: coniferous and broadleaf). 
<!-- The radius of the circle necessary to characterize the landscape depends on the scale of the landscape that matters to a given organism [@addicott1987]. -->
At each site, we extracted the proportion of each cover class within 30m annuli (rings), with the inner radius of each annulus ranging from 30 to 1470m in increments of 30m (total of 49 annuli, 1.5 km maximum).
The ten most-common cover classes surrounding our sites represented 98% of the total land cover in our study region: grassland, cereal, canola, pasture, pulses, wetland, urban (road margins), shrubland, flax, and forests (Figure \@ref(fig:landscapeComp)); flax was removed, as only a single site had nearby flax cover.

## Analysis

Functional regression [@ramsay2004; @yen2014] was used to incorporate landscape information at different distances, allowing assessment of both local and regional landscape composition [@galpern2020].
Scalar-on-function regression is a special type of linear regression model ($y=X\beta + e$), where the columns of the model matrix $X$ contain some continuous predictor of the scalar $y$, and the values of the coefficients ($\beta$) are modeled as a smooth function $f(x)$ of the predictors.
<!-- As an example of scalar-on-function regression, biomass in a plot (scalar) could be modeled as a smoothed function of monthly average temperatures at that plot (function), meaning that the effect of monthly temperatures would also be a function of time. -->
In our case, the proportion of landscape cover ($X$) within each annulus surrounding the trap is a function of distance away from the trap, meaning that the coefficients are a smoothed function of distance ($\beta_i = f(distance_i)$), and represent the additive effect of a given type of landscape cover at distances away from the trap (i.e. $X\beta$).
This allows for the possibility that the size of the landscape "grain" relevant to a given organism may change over the course of its life stages [@addicott1987; @lima1996; @gardiner2010].
It also allows for the possibility that certain land cover types may be locally beneficial, but detremental at wider scales, indicating that the cover type may not constitute a completely usable habitat.

Scalar-on-function regression of activity-density was fit using generalized additive models [_mgcv_ version `r packageVersion('mgcv')`; @wood2017]. 
Count data of arthropods were modeled using a negative binomial distribution with a log-link function and a single dispersion parameter ($\theta$).
To account for different lengths of trap exposure, log-days since trap placement were used as a fixed effect with their slope held at 1 ("offset" variable).
Trapping location was included as a fixed effect with 5 levels (canola, field edge, grassland, road margin, and wetlands) to account for the effect of local cover independent of the surrounding landscape composition. 
Day of year was included as a 1-dimensional smooth, and easting and northing (km east and north of the trap extent centre point) were included as 2-dimensional smooths, in order to account for underlying spatial and temporal autocorrelation in the data.

For each landscape cover class, we used three scalar-on-function terms.
First, we used the proportion cover in the annuli surrounding each trap location (spatial effect of cover class).
Second, we used the average landcover in all annuli across days of the year (temporal effect of cover class). 
Finally, we used a tensor-product interaction of landscape cover and day of year (spatio-temporal interaction of cover class).
We used 10 basis dimensions for the spatial and temporal landscape smoothers, and 16 basis dimensions for the spatio-temporal interaction.
This was deemed adequate, as the effective degrees of freedom for all smoothing terms were far below the number of basis dimensions, indicating that no additional basis dimensions were needed (see Tables \@ref(tab:PteMelSmooth), \@ref(tab:ParDisSmooth), \@ref(tab:ParMoeSmooth), \@ref(tab:OpilioSmooth)).
To remove unimportant terms from the model, we used thin-plate regression splines with shrinkage, a continuous analog to stepwise model selection where weaker terms are completely removed from the model rather than reduced to a line [@marra2011].
The deviance residuals from each model were visually inspected for normality and equal variance [@hilbe2011; @wood2017].
Finally, we calculated the proportion of explained variance (R$^2$) for each set of terms [@nakagawa2013; @nakagawa2017].

<!-- + Double-penalization gave qualitatively similar results, but required twice the number of penalty terms, and some of the penalty terms were unstable  -->

Preliminary model fits revealed that some of the landscape terms in our model were strongly concurved with each other, so we removed them from the model or combined them.
Concurvity is a nonlinear analogue of multicollinearity which can bias estimates of standard errors [@buja1989].
There is no agreed-upon threshold of "unacceptable" concurvity, but 0.5 is commonly used [@dominici2002; @ramsay2003]. 
<!-- Some landscape terms were strongly concurved , namely forest and shrubland (max: 0.71), canola and cereal (max: 0.74), and grassland and wetland (max: 0.63). -->
Forests and shrubland were combined into a single ``woodland" category, and grassland and wetland were combined into a single "grassland" category, as they were strongly positively correlated at all distances, indicating similar feature classes.
Cereal was removed from the model, as it was negatively correlated with canola cover at distances less than 200m and was positively correlated at distances over 500m, reflecting the most common crop rotations (canola $\rightarrow$ wheat $\rightarrow$ barley) and the commonly-used 800 m block structure of farmland in our study region (quarter-sections).
This resulted in a reduced set of landscape terms, none of which were strongly concurved with each other (cropland: canola, pulses; SNL: grassland, pasture, woodland, roadside; see Figure \@ref(fig:concurvity)).

***
**Box 1: Interpreting Functional Regression Plots**

Functional linear regression is a special case of linear regression, where both the independent variable is predicted by a functional dependent variable, meaning that the slope is a function (vector) rather a fixed (scalar) value [@ramsay2004; @yen2014].
Therefore, the interpretation of a functional regression plot is very different from that of a simple linear regression plot.
Figure \@ref(fig:frExample)a shows a simple linear regression plot of a hypothetical relationship between trap _activity density_ (_y_) and a single predictor, _Proportion cover_ (_x_), which is measured in a circle of a fixed radius (_Distance_) surrounding each trap.
If we suppose that the relationship between _x_ and _y_ is similar at all radii at which _x_ is measured, then Figure \@ref(fig:frExample)b shows the resulting functional linear regression plot, where the slope ($\beta$) is the same at all distances.
In reality it is more likely that nearby cover will be more influential on activity density than far-away cover, which would result in a relationship similar to Figure \@ref(fig:frExample)c.
As functional regression takes any continuous predictor of _y_, it is also possible to use proportion cover (measured within a fixed radius) as a predictor of measurements taken across time, allowing the effect of proportion cover to vary over the course of the season (Figure \@ref(fig:frExample)d).
Finally, proportion cover over distance and time may be combined into a smoothed surface of effects, representing the spatio-temporal influence of landscape cover on activity density.

```{r frExample, echo=FALSE, fig.cap='Examples of (functional) linear regression plots. \\textbf{a)} shows a simple linear regression plot, with a single slope value for a single regressor. \\textbf{b)} shows the equivalent plot in functional regression form, where the the slope is a smoothed function that maps onto a function-valued regressor. \\textbf{c)} and \\textbf{d)} show functional linear regression plots where the slope varies with the location of the regressor.', out.width='100%'}  
  include_graphics('../figures/frExample.png',dpi=NA)
```

***
  
Functional regression plots of landscape composition reveal which cover classes are acting as spillover sources or sinks of a given arthropod, and at what spatial scale.
Positive effects of nearby landscape cover classes indicate that arthropods are spilling over *from* it.
However, negative responses to nearby landscape cover classes can indicate one of two things:
1) It may indicate that arthropods are spilling over *into* it (i.e. net sink for spillover) or 2) it may indicate that no arthropods are available to spill over *from* it.
We consider 1) to be the more likely scenario, as it is unlikely that any one cover class is *completely* unoccupied.
<!-- As these data were collected from a single year, this model does not consider the next-generation fitness consequences of spillover. -->
For example, a cover class with low-quality habitat could act as an ecological trap [@galpern2017] if it acts as a net sink but never acts as a source of spill over.
Alternatively, a cover class could act as a sink by providing high-quality habitat at certain times of the year (e.g. egg laying/feeding), but act as a source at other times (e.g. during emergence).
For brevity in the following Results section, we refer to local- and landscape-level effects, where local indicates the effects of landscape composition at scales of <500m, whereas landscape indicates scales >500 m.
Similarly, we refer to early-, mid-, and late-season effects, where landscape composition affected abundance from June - July, July - August, or August - September, respectively.

# Results

## Landscape composition and trap catches 

Grassland, cereal, and canola were the three most-abundant landcover classes surrounding our traps, accounting for `r coverList %>% group_by(cover) %>% summarize(p=sum(prop)) %>% ungroup() %>% arrange(desc(p)) %>% mutate(prop=round(100*p/sum(p),2)) %>% slice(1:3) %>% pull(prop) %>% sum `% of land cover (Figure \@ref(fig:landscapeComp)).
Several landscape ``fingerprints" were evident in the landscape annuli, with cereal cover increasing with distance away, along with a corresponding decrease in canola cover.
Study sites were originally chosen for sampling arthropods surrounding canola agroecosystems, so canola was a dominant signal in the landscape, but there was also a large amount of variation in grassland and pasture surrounding each site (Figure \@ref(fig:landscapeComp)).
Grassland cover was largely constant with distance, but a cluster of sites had uniformly high or low cover of grassland with distance.
The pitfall traps caught a total of `r with(Ncatches,total[spp=='PteMel'])` _Pterostichus melanarius_, `r with(Ncatches,total[spp=='ParDis'])` _Pardosa distincta_, `r with(Ncatches,total[spp=='ParMoe'])` _Pardosa moesta_, and `r with(Ncatches,total[spp=='Opilio'])` _Phalangium opilio_ (mean trapping rates per day: `r with(Ncatches,paste(round(perDayMean,2),collapse=', '))`, SD: `r with(Ncatches,paste(round(perDaySD,2),collapse=', '))`, respectively).

```{r landscapeComp, echo=FALSE, fig.cap='Landscape composition in annuli surrounding each trap location. Sites are represented by individual lines. Mean cover for each class is listed in each sub-figure heading.', fig.width=5, fig.height=5}  
coverList %>% group_by(cover) %>% mutate(p=sum(prop)) %>% ungroup() %>% mutate(p=100*round(p/sum(unique(p)),4)) %>% 
  mutate(cover=paste0(as.character(cover),' (',p,'%)'),prop=prop*100) %>% 
  mutate(cover=factor(cover,levels=unique(cover))) %>% 
  ggplot(aes(dist,prop,group=site))+geom_line(alpha=0.2)+
  facet_wrap(~cover,ncol=4)+theme_classic()+theme(axis.text = element_text(size = 8),strip.text=element_text(size=8))+
  labs(y='Percent cover',x='Inner radius of annuli (m)')
```

## *Ground beetle:* Pterostichus melanarius

_P. melanarius_ activity-density was strongly influenced by trap location and landscape composition (Tables \@ref(tab:PteMelLinear), \@ref(tab:PteMelSmooth)).
Canola crops had a marginally higher activity-density of _P. melanarius_ than other trap locations (Figure \@ref(fig:PteMelLandscape)a).
Grassland cover was the most important land cover type in explaining activity-density ($R^2$: 0.104, Table \@ref(tab:rSquared)), and local grassland had a negative effect late in the summer (Figure \@ref(fig:PteMelLandscape)b), suggesting that _P. melanarius_ may move into grasslands later in the year.
Local canola had a positive effect in the early season, but landscape-level canola had a negative effect, indicating that areas with widespread canola coverage had lower _P. melanarius_ activity-density (Figure \@ref(fig:PteMelLandscape)c).
Pulses acted as a late-season source, indicating that _P. melanarius_ may migrate out of the crop after (or during) harvest (Figure \@ref(fig:PteMelLandscape)d).
Finally, _P. melanarius_ activity-density had a strong temporal and spatial component (both p `r with(pmelSmTerms,p[Smoother=='s(E,N)'])`), indicating that phenology and local geographic factors were important drivers of ground beetle activity-density (Figure \@ref(fig:PteMelSpatiotemporal)).
Landscape composition and trap location explained `r r2Nakagawa$PteMelMod[1]*100`% of the variance in activity-density, while the spatial and temporal smoothers accounted for `r with(r2Nakagawa,(PteMelMod[2]-PteMelMod[1])*100)`% (Table \@ref(tab:rSquared)).

<!-- Percent signs are escaped in LaTeX, but this causes havoc if used in fig.cap of chunk options (OK if used in internal captions, I think). Yihui uses the following "text references" instead. -->
(ref:PteMelCap) Landscape influence on _Pterostichus melanarius_ activity-density. a) shows the effect of local trap location, and b-c) are functional regression plots of the proportion grassland and canola at distances away from each trap. d) is a functional regression plot over time, showing the effect of pulses at different times of the year. Lines and dots represent means, and bars and shaded regions represent 95 % confidence regions (1.96 x SE). Coloured regions represent early-, mid-, and late-season effects (blue = June, purple = July, red = August).

```{r PteMelLandscape, echo=FALSE, fig.cap='(ref:PteMelCap)', out.width='100%'}  
  include_graphics('../figures/Pterostichus_melanarius_fixeff.png',dpi=NA)
```

## *Wolf spiders:* Pardosa distincta *and* Pardosa moesta

Activity density of _P. distincta_ and _P. moesta_ was influenced by trap location and landscape composition (Tables \@ref(tab:ParDisLinear), \@ref(tab:ParDisSmooth), \@ref(tab:ParMoeLinear), \@ref(tab:ParMoeSmooth)), but landscape composition had relatively weak effects on both species ($R^2$: `r filter(r2Nakagawa2,grepl('Par',model),!grepl('s\\(',terms),terms!='trapLoc',terms!='sigmaD') %>% group_by(model) %>% summarize(s=sum(r2comp)) %>% pull(s) %>% paste(.,collapse=', ')`).
Unlike _P. melanarius_, both _Pardosa_ species had far lower activity-density in canola than any other cover type (Figures \@ref(fig:ParDisLandscape)a, \@ref(fig:ParMoeLandscape)a).
Activity-density of both _Pardosa_ species had a strong temporal and spatial component, although the temporal component was dominant for _P. distincta_, whereas the spatial component was dominant for _P. moesta_ (Figures \@ref(fig:ParDisSpatiotemporal) and \@ref(fig:ParMoeSpatiotemporal); both p`r with(pmoeSmTerms,p[Smoother=='s(E,N)'])`).

_P. distincta_ activity density was negatively affected by landscape-level pasture (Figure \@ref(fig:ParDisLandscape)b), while woodlands had a negative effect late in the season (Figure \@ref(fig:ParDisLandscape)c).
This suggests that large amounts of pasture are unsuitable habitat for _P. distincta_, and that they migrate into woodlands later in the season.
However, trap location and the temporal random effect (Figure \@ref(fig:ParDisSpatiotemporal)a) explained roughly 10 times more variance than landscape composition ($R^2$: `r round(sum(filter(r2Nakagawa2,model=='ParDisMod',terms=='trapLoc'|grepl('day',terms))$r2comp),3)` versus `r round(sum(filter(r2Nakagawa2,model=='ParDisMod',terms!='trapLoc',terms!='sigmaD',!grepl('s\\(',terms))$r2comp),3)`), meaning that while _P. distincta_ may be locally abundant in certain cover types, it is highly general in its overall habitat preferences.
<!-- The weak effect of canola crops (p>0.07) suggests that this species does not aggregate into these crops, meaning that its ecosystem service potential to farmers is limited. -->

_P. moesta_ activity density responded to grassland, canola, and road margins.
Grasslands had a local negative effect, but a positive landscape-level effect, indicating that while these cover types act as a local sink, the general amount of grassland in the area had a positive effect (Figure \@ref(fig:ParMoeLandscape)b).
Local canola cover had a positive early effect on activity-density, but a negative local effect later in the season (Figure \@ref(fig:ParMoeLandscape)c).
Local road margins also had a similar effect, acting as an early source and a late sink (Figure \@ref(fig:ParMoeLandscape)d).
Pulses also had a positive effect at the landscape level (Figure \@ref(fig:ParMoeLandscape)e), but this explained very little variance in _P. moesta_ activity density (Table \@ref(tab:rSquared), $R^2$: `r round(filter(r2Nakagawa2,model=="ParMoeMod",terms=="Pulses")$r2comp,3)`).
Similar to _P.distincta_, trap location and an East-West spatial random effect (Figure \@ref(fig:ParMoeSpatiotemporal)b) explained roughly 5 times more variance in _P. moesta_ activity density than landscape composition ($R^2$: `r round(sum(filter(r2Nakagawa2,model=='ParMoeMod',terms=='trapLoc'|grepl('E,N',terms))$r2comp),3)` versus `r round(sum(filter(r2Nakagawa2,model=='ParMoeMod',terms!='trapLoc',terms!='sigmaD',!grepl('s\\(',terms))$r2comp),3)`), meaning that _P. moesta_ is also fairly general in its overall habitat preferences, and is influenced more heavily by larger-scale abiotic factors.

(ref:ParDisCap) Landscape influence on _Pardosa distincta_ activity-density. a) shows the effect of local trap location, b) is a functional regression plot of the proportion pasture at distances away from each trap, and c) is a functional regression plot over time, showing the effect of woodland at different times of the year. Lines and dots represent means, and bars and shaded regions represent 95 % confidence regions (1.96 x SE). Coloured regions represent early-, mid-, and late-season effects (blue = June, purple = July, red = August).

```{r ParDisLandscape, echo=FALSE, fig.cap='(ref:ParDisCap)', out.width='100%'}  
  include_graphics('../figures/Pardosa_distincta_fixeff.png',dpi=NA)
```

(ref:ParMoeCap) Landscape influence on _Pardosa moesta_ activity-density. a) shows the effect of local trap location, and b-e) are functional regression plots of the proportion grassland, canola, road margins, and pulses at distances away from each trap. Lines and dots represent means, and bars and shaded regions represent 95 % confidence regions (1.96 x SE). Coloured regions represent early-, mid-, and late-season effects (blue = June, purple = July, red = August).

```{r ParMoeLandscape, echo=FALSE, fig.cap='(ref:ParMoeCap)', out.width='100%'}  
  include_graphics('../figures/Pardosa_moesta_fixeff.png',dpi=NA)
```

## *Harvestman:* Phalangium opilio 

_P. opilio_ activity-density was somewhat influenced by trap location, with field edges and wetlands having the highest activity-density (Figure \@ref(fig:OpilioLandscape)a), but this effect was swamped by the effect of landscape and the spatiotemporal random effects (Table \@ref(tab:rSquared)), meaning that _P. opilio_ activity density is only mildly influenced by local cover type.
Nearby grassland and woodland both had negative effects on _Phalangium opilio_ activity-density, but only early in the season (Figures \@ref(fig:OpilioLandscape)b,c), suggesting that _P. opilio_ may preferentially migrate to these cover classes.
The temporal random effect was overwhelmingly the most important predictor of _P. opilio_ activity-density ($R^2$: `r round(sum(filter(r2Nakagawa2,model=='OpilioMod',terms=='s(day)')$r2comp),3)`), showing that activity-density increased during the spring, and showed very little decline during the rest of the season (Figure \@ref(fig:OpilioSpatiotemporal)a).
Similar to _P. moesta_, _P. opilio_ also showed a distinct East-West spatial random effect (Figure \@ref(fig:OpilioSpatiotemporal)b), indicating that their activity-density is also influenced by larger-scale abiotic factors.

(ref:OpilioCap) Landscape influence on _Phalangium opilio_ activity-density. a) shows the effect of local trap location, and b-c) are functional regression plots of the proportion grassland and woodland at distances away from each trap. Lines and dots represent means, and bars and shaded regions represent 95 % confidence regions (1.96 x SE). Coloured regions represent early-, mid-, and late-season effects (blue = June, purple = July, red = August). __SHOULD WE TAKE OUT THE MID (PURPLE) TIME SEQUENCE, IN THE INTEREST OF READABLILITY? THIS WOULD WORK FINE FOR ALL OTHER FIGURES, EXCEPT FOR c OF THIS ONE.__

```{r OpilioLandscape, echo=FALSE, fig.cap='(ref:OpilioCap)', out.width='100%'}  
  include_graphics('../figures/Opiliones_fixeff.png',dpi=NA)
```


```{r rSquared, echo=FALSE, out.width='100%'}  
r2Nakagawa2 %>% select(model,terms,r2comp) %>% mutate(terms=as.character(terms),r2comp=r2comp*1) %>%
  pivot_wider(names_from=model,values_from=r2comp) %>%
  mutate(terms=case_when(terms=='trapLoc' ~ 'Trap Location', terms=='s(day)' ~ 'Day of Year',
                         terms=='s(E,N)' ~ 'Spatial Location', terms=='GrassWetland' ~ 'Grassland',
                         terms=='TreeShrub' ~ 'Woodland', terms=='sigmaD' ~ 'Residual',
                         terms=='Urban' ~ 'Road margins', TRUE ~ terms)) %>%
  kable(.,format='latex',caption='R$^2_{GLMM}$ for model components, representing the proportion of total variance explained by each term. R$^2$ was calculated using methods from Nakagawa et al. 2013 and Nakagawa et al. 2017.',
        col.names=linebreak(x=c('Term','\\emph{Pterostichus}\n\\emph{melanarius}','\\emph{Pardosa}\n\\emph{distincta}',
                              '\\emph{Pardosa}\n\\emph{moesta}','\\emph{Phalangium}\n\\emph{opilio}'),align='l'),
        digits=c(1,3,3,3,3),align='rllll',escape=FALSE)
```

```{r resultsTab, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}
#Based on example from:
# https://stackoverflow.com/questions/31011265/how-to-write-bullet-lists-in-a-table-using-rmarkdown-and-pandoc
# #Note: this works, but it's very ugly. Trying kable instead
# mytable <- data.frame(
#     CoverClass = c("Grassland", "Canola", "Pasture", "Woodland", "Pulses", "Road margins"),
#     PteMel = c('* Local sink ','* Local source (early) \n* Landscape sink (early)',' ',' ','* Source (late)',' '),
#     ParDis = c(' ',' ','* Landscape sink',' * Sink (late)',' ',' '),
#     ParMoe = c('* Local sink \n* Landscape source','* Local source (early) \n* Local sink (late)',' ',' ','* Landscape source','* Local source (early) \n* Local sink (late) \n* Landscape sink (early) \n* Landscape source (late)'),
#     Opilio = c('* Local sink (early)',' ',' ','* Local sink (early) \n* Landscape source (mid)',' ',' ')
#     )
# colnames(mytable) <- c('Cover class','_Pterosticus_ _melanarius_','_Pardosa_ _distincta_','_Pardosa_ _moesta_','_Phalangium_ _opilio_')
# pander(mytable, keep.line.breaks = TRUE, style = 'grid', justify = 'left', split.table=1000)

# #Based on example https://stackoverflow.com/questions/52962411/table-with-long-text-bullet-points-and-specific-table-width
# #Much better than above, but not very easy to absorb. Perhaps there should be some kind of organismal-based synthesis table?
# summaryTab <- data.frame(
#     CoverClass = c("Grassland", "Canola", "Pasture", "Woodland", "Pulses", "Road margins"),
#     PteMel = c('$\\cdot$ Local -- (late)','$\\cdot$ Local + (early) \n$\\cdot$ Landscape -- (early)',' ',' ','$\\cdot$ Overall + (late)',' '),
#     ParDis = c(' ',' ','$\\cdot$ Landscape --',' $\\cdot$ Overall -- (late)',' ',' '),
#     ParMoe = c('$\\cdot$ Local -- \n$\\cdot$ Landscape +','$\\cdot$ Local + (early) \n$\\cdot$ Local -- (late)',' ',' ','$\\cdot$ Landscape +','$\\cdot$ Local + (early) \n$\\cdot$ Local -- (late) \n$\\cdot$ Landscape -- (early) \n$\\cdot$ Landscape + (late)'),
#     Opilio = c('$\\cdot$ Local -- (early)',' ',' ','$\\cdot$ Local -- (early) \n$\\cdot$ Landscape + (mid)',' ',' ')
#     )
# 
# summaryTab %>%
#   mutate_all(linebreak) %>%  # required for linebreaks to work
#   kable(.,format='latex',caption='Summary of model results. \\emph{Local/Landscape} denotes cover classes <500m or >500m away from the trap location, respectively. +/-- indicates positive or negative effects of the cover class, and \\emph{Early/Mid/Late} denotes whether the effects were present earlier or later during the season. Cover classes with weak effects on activity density are not shown.',
#         col.names=linebreak(x=c('Cover class','\\emph{Pterostichus}\n\\emph{melanarius}','\\emph{Pardosa}\n\\emph{distincta}',
#                               '\\emph{Pardosa}\n\\emph{moesta}','\\emph{Phalangium}\n\\emph{opilio}')),
#         align='rllll',escape=FALSE) %>% 
#   column_spec(1, width = "4em") %>% column_spec(c(2:5), width = "9em") # fix column widths

##Attempt at synthesis table
mytable <- data.frame(
  Species = c(' \\emph{Pterostichus}\n\\emph{melanarius}',' \\emph{Pardosa}\n\\emph{distincta}',
                              ' \\emph{Pardosa}\n\\emph{moesta}',' \\emph{Phalangium}\n\\emph{opilio}'),
    Summary = as.character(c('$\\cdot$ Aggregates in canola during early season \n$\\cdot$ Disperses to grassland during late season',
                '$\\cdot$ Negative effect of pasture \n$\\cdot$ May locally aggregate in field edges',
                '$\\cdot$ Aggregates in canola during early season \n$\\cdot$ Disperses to road margins and grassland during late season \n$\\cdot$Aggregates in grasslands across the season.',
                '$\\cdot$ Aggregates to grassland early in the season')),
    BioControl= as.character(c('High','Low','Medium','Low'))
    )
# pander(mytable, keep.line.breaks = TRUE, style = 'grid', justify = 'left', split.table=1000)
mytable %>% mutate_all(linebreak) %>% 
  kable(.,format='latex',caption='Synthesis of model results. Bio-control potential is based on likely early-season aggregation to canola crops.',escape=FALSE,
      col.names=c('Species','Summary','Bio-control potential'),align='lll') %>% 
  column_spec(2,width='15em')

```

# Discussion

<!-- The activity-density of the four arthropods was influenced by landscape composition, but the response of _Pterostichus melanarius_ and _Phalangium opilio_ was much stronger. -->
We found support for our predictions of SNL having late-season effects on beneficial arthropods; specifically, grassland had a negative effect on _P. melanarius_ activity-density, woodlands on _P. distincta_ activity density, and road margins on _P. moesta_ activity density, all during late summer (August - September).
This suggests that these arthropods migrate to these habitats at the end of the summer to prepare for oviposition or overwintering.
However, _P. opilio_ showed no evidence of this, instead showing a negative effect of grassland _early_ in the season, suggesting that a) they aggregate in grasslands or b) grasslands do not constitute suitable habitat for _P. opilio_, resulting in low spillover.
There was little evidence of SNL acting as early-season sources, aside from road margins having a positive early effect on _P. moesta_ activity-density.
However, some cover classes had a positive effect at the landscape level (grassland and road margins on _P. moesta_), suggesting earlier or wider-scale dispersal away from these cover classes.
Canola had a positive effect on _P. melanarius_ and _P. moesta_ in the early season, suggesting that these organisms aggregate to canola crops and disperse at the end of the season [mass effects _sensu_ @shmida1985].
Canola also had negative landscape-level effects on _P. melanarius_ while pasture had negative effects on _P. distincta_, meaning that these cover types likely represent only partial habitat for these arthropods.
Finally, the influence of landscape composition tended to be limited to a radius of about 500m, indicating that large-scale _and_ local land cover can be important to beneficial arthropod abundance.
There was also a strong temporal component to most of the landscape effects, meaning that it is important to consider how sinks and sources may change over the season.

<!-- 1. ... nearby SNL should act as a source of arthropods during the early part of the season, and a sink during the later part of the season.  -->
<!-- 2. ... should result in agricultural land becoming a sink for predators in the early part of the season as they migrate into the crop, and a source at the end of the season as they migrate out of the crop. -->
<!-- 3. ... crops may act as a local sink for arthropods, but will also be negatively associated at larger (landscape-level) scales. -->

The predatory ground beetle _Pterostichus melanarius_ responded to landscape composition, primarily to canola, pulses, and grass and wetland cover.
Grassland and wetland cover had a negative late-season effect, suggesting that _P. melanarius_ migrates into it at the end of the summer.
Other studies have found similar results, suggesting that untilled land is important off-field habitat for carabids [@desender1988; @fournier2002; but see @hatten2007].
In particular, @purtauf2005 found that carabid density increased with proportion of nearby grasslands, so our negative late-season effect of grasslands may represent _P. melanarius_ moving to overwintering habitat at the end of the season.
However, _P. melanarius_ is also found in a wide variety of habitats, and tends to prefer agricultural fields [@larsen2003]. 
Our models confirmed this, as they showed that canola and pulse crops had positive effects on _P. melanarius_ activity-density early in the season.
Early in the season, canola crops had a local positive effect, but a landscape-level negative effect, which may indicate that they provide only temporary feeding habitat.
The effect of pulse crops on carabid abundance is not well-studied, but our results suggest that pulses may represent a potential food resource for _P. melanarius_, albeit a weak one (Table \@ref(tab:rSquared)).
Carabids are predators of pea-leaf weevils (_Sitona lineatus_) on other Fabaceae [@hamon1990], and _P. melanarius_ can prey upon other carabids that are predators of _S. lineatus_, such as _Bembidion quadrimaculatum_ [@vankosky2011], so this effect may be direct or indirect.
We did not consider the influence of previous years' crops, although carabids tend to be more abundant in areas of high crop rotation [@busch_Msc; @bertrand2016].

The wolf spiders _Pardosa distincta_ and _Pardosa moesta_ both responded to landscape composition, but it explained only a small fraction of their activity-density ($R^2$: `r round(sum(filter(r2Nakagawa2,model=='ParDisMod',terms!='trapLoc',terms!='sigmaD',!grepl('s\\(',terms))$r2comp),3)`, `r round(sum(filter(r2Nakagawa2,model=='ParMoeMod',terms!='trapLoc',terms!='sigmaD',!grepl('s\\(',terms))$r2comp),3)`).
This means that both species of _Pardosa_ appear to have very general habitat preferences, but may be somewhat influenced by certain cover types.
Pasture had a negative effect at the landscape scale, and woodland had a late-season negative effect, suggesting that _P. distincta_ move to woodlands for overwintering or winter foraging [@aitchison1984; @buddle2000].
_Pardosa_ are found in areas close to disturbed roadside strips [@drapela2008; @drapela2011; @kowal2011], but _P. distincta_ appears to be less sensitive to disturbances than _P. moesta_ [@collins1996; @wade2010].
@moring1994 showed that _P. distincta_ were active in grassy habitats, which we found partial evidence of, as _P. distincta_ tended to have higher activity-density in trap locations with higher grass cover (Figure \@ref(fig:ParDisLandscape)a).
Canola had an early-season positive effect on _P. moesta_, indicating that _P. moesta_ and _P. melanarius_ may both use canola as foraging grounds.
We also found that road margins had a positive early-season and a negative late-season effect [similar to @drapela2008 and @drapela2011]. 
Grassland and pulses also had a local negative effect but a positive landscape-level effect; this suggests that they may constitute suitable habitat for _P. moesta_ and attract them away from other cover types.
Wolf spiders (Lycosidae) employ a wandering-active predation strategy [@young1990], meaning that nearby landscape composition may be more influential to _Pardosa_ than large-scale composition [@oberg2007; @oberg2008].
While trapping location explained a large proportion of variance for both species (`r round(filter(r2Nakagawa2,model=='ParDisMod',grepl('trapLoc',terms))$r2comp,2)` and `r round(filter(r2Nakagawa2,model=='ParMoeMod',grepl('trapLoc',terms))$r2comp,2)`), several landscape features were also important at large spatial scales, including grass and wetland, pasture, pulses, and road margins. 
Therefore, _Pardosa_ dispersal distances may be further than previously thought, either through ballooning as juveniles [@richter1970; @greenstone1982] or through other long-distance travel.

_Phalangium opilio_ activity-density responded to grass and wetland cover, as well as wooded landscapes.
Other studies have found that _P. opilio_ is mostly found in human-altered landscapes with a large proportion of farming [@muster2014; @vandepoel2015Msc].
Since most of our study area was in or near farmed land, the lack of variation is understandable, but there were a few notable landscape-level patterns that emerged.
_P. opilio_ activity-density was higher in grassy field edges and wetlands, but grasslands and wetlands had a local negative effect on _P. opilio_ until late in the season.
These indicate that while grass and wetlands could act as a reservoir, spillover into other land cover types may be limited, as _P. opilio_ avoids heavily grazed areas, possibly due to low humidity [@sajna2011].
_P. opilio_ is also found in large numbers at the edges of forests, and may migrate from forests into farmlands [@vandepoel2015Msc].
We found the opposite pattern: forests had a weak negative effect on _P. opilio_, at least early in the year.
Unlike the other arthropods, most of the variation in activity-density for _P. opilio_ was explained by day of year (R$^2$ = `r round(filter(r2Nakagawa2,model=='OpilioMod',grepl('day',terms))$r2comp,2)`), indicating strong seasonal emergence cues.
However, there was also a strong East-West spatial random effect in both _P. opilio_ and _P. moesta_, meaning that wider-scale geographic patterns (possibly related to rainfall or temperature) also influence their activity-density.
<!-- Feels like this paragraph ends too soon. Why was there so little variation due to landscape? Link to biology of the critter. -->

Many other studies have considered the overall effect of SNL on ecosystem service provision, but we have highlighted the different spatial and temporal aspects of ecosystem service provision.
We have shown how a relatively straightforward statistical technique can be used to consider multiple spatial scales of landscape composition, providing richer inference about the processes acting on beneficial arthropods.
Our results show empirical evidence of arthropod migration between cover types at different times of year, which is rarely considered beyond single-field studies.
Since we did not directly track individual movements, future studies should directly examine arthropod movement and life-history within matrices of cover types, with the goal of integrating landscape ecology and behavioural processes into a single model [@lima1996].
This would also allow direct inference about landscape categories that were combined in our dataset, allowing us to consider different landscape categories independently.
Finally, future work should explicitly link landscape structure, arthropod abundance, and ecosystem services [@gagic2017].

# Applications

Our work has three main applications.
First, it adds to the basis of scientific evidence showing that SNL can act as reservoir habitats in intensely-managed agroecosystems.
Based on our findings, farmers and land managers should consider preserving existing grassland and wetland habitat to act as a background source of pest-control in crop fields.
While local habitat appears valuable, even landscape-level habitat can be valuable, as it can increase the number of beneficial arthropods at larger spatial scales (e.g. Figures \@ref(fig:PteMelLandscape), \@ref(fig:ParMoeLandscape)).
Secondly, our work suggests that _P. melanarius_ and _P. moesta_ should be investigated for their role as predators in canola crops.
They appear to aggregate in canola crops early in the season, meaning that they have the potential to provide valuable pest-control services to growers.
Finally, we demonstrate that timing and spatial scale of spillover should be considered in future landscape studies of ecosystem services.
We show important differences in the timing of landscape effects on activity-density (early-season vs. late-season spillover) that are typically ignored, but should be considered when assessing how SNL can deliver ecosystem services.

\newpage 

# Supplementary Material {-}

\beginsupplement

```{r concurvity, echo=FALSE, fig.cap='Concurvity estimates for reduced cover classes used in models.', out.width='100%'}  
  include_graphics('../figures/coverCorPlots/concurvityEstimate_reduced.png',dpi=NA)
```

(ref:PteMelSTCap) Temporal and spatial components of _Pterostichus melanarius_ activity-density (after accounting for landscape composition and trap location). a) shows the effect of day of year, and b) shows the spatially smoothed effect of site location.

```{r PteMelSpatiotemporal, echo=FALSE, fig.cap='(ref:PteMelSTCap)', out.width='100%'}
  include_graphics('../figures/Pterostichus_melanarius_raneff.png',dpi=NA)
```

(ref:ParDisSTCap) Temporal and spatial components of _Pardosa distincta_ activity-density (after accounting for landscape composition and trap location). a) shows the effect of day of year, and b) shows the spatially smoothed effect of site location.

```{r ParDisSpatiotemporal, echo=FALSE, fig.cap='(ref:ParDisSTCap)', out.width='100%'}
  include_graphics('../figures/Pardosa_distincta_raneff.png',dpi=NA)
```

(ref:ParMoeSTCap) Temporal and spatial components of _Pardosa moesta_ activity-density (after accounting for landscape composition and trap location). a) shows the effect of day of year, and b) shows the spatially smoothed effect of site location.

```{r ParMoeSpatiotemporal, echo=FALSE, fig.cap='(ref:ParMoeSTCap)', out.width='100%'}
  include_graphics('../figures/Pardosa_moesta_raneff.png',dpi=NA)
```

(ref:OpilioSTCap) Temporal and spatial components of _Phalangium opilio_ activity-density (after accounting for landscape composition and trap location). a) shows the effect of day of year, and b) shows the spatially smoothed effect of site location.

```{r OpilioSpatiotemporal, echo=FALSE, fig.cap='(ref:OpilioSTCap)', out.width='100%'}
  include_graphics('../figures/Opiliones_raneff.png',dpi=NA)
```

```{r PteMelLinear, echo=FALSE, warning=FALSE}
pmelLinTerms %>% select(-p) %>% 
  kable(.,caption='Trap location (cover type that trap was located in) intercept estimates for \\emph{Pterostichus melanarius}',col.names=c('Trap location','$\\beta$','S.E.','Z','p'),
      digits=c(1,2,2,2,2),align='rrrrl',escape=FALSE)
```


```{r PteMelSmooth, echo=FALSE, warning=FALSE}
pmelSmTerms %>% select(-Ref.df,-p) %>% 
  kable(.,caption='Smooth terms for \\emph{Pterostichus melanarius}. \\emph{s} indicates a thin-plate spline, \\emph{ti} indicates a tensor-product interaction. All terms except for day and (E,N) are functional regression fits.',
      col.names=c('Smoothing term','E.d.f.','$\\chi^2$','p'),
      digits=c(1,2,2,2),align='rrll',escape=FALSE)
```

```{r ParDisLinear, echo=FALSE, warning=FALSE}
pdisLinTerms %>% select(-p) %>% 
  kable(.,caption='Trap location (cover type that trap was located in) intercept estimates for \\emph{Pardosa distincta}',col.names=c('Trap location','$\\beta$','S.E.','Z','p'),
        digits=c(1,2,2,2,2),align='rrrrl',escape=FALSE)
```

```{r ParDisSmooth, echo=FALSE, warning=FALSE}
pdisSmTerms %>% select(-Ref.df,-p) %>% 
  kable(.,caption='Smooth terms for \\emph{Pardosa distincta}. \\emph{s} indicates a thin-plate spline, \\emph{ti} indicates a tensor-product interaction. All terms except for day and (E,N) are functional regression fits.',
        col.names=c('Smoothing term','E.d.f.','$\\chi^2$','p'),
        digits=c(1,2,2,2),align='rrll',escape=FALSE)
```

```{r ParMoeLinear, echo=FALSE, warning=FALSE}
pmoeLinTerms %>% select(-p) %>% 
  kable(.,caption='Trap location (cover type that trap was located in) intercept estimates for \\emph{Pardosa moesta}.',col.names=c('Trap location','$\\beta$','S.E.','Z','p'),
        digits=c(1,2,2,2,2),align='rrrrl',escape=FALSE)
```

```{r ParMoeSmooth, echo=FALSE, warning=FALSE}
pmoeSmTerms %>% select(-Ref.df,-p) %>% 
  kable(.,caption='Smooth terms for \\emph{Pardosa moesta}. \\emph{s} indicates a thin-plate spline, \\emph{ti} indicates a tensor-product interaction. All terms except for day and (E,N) are functional regression fits.',
        col.names=c('Smoothing term','E.d.f.','$\\chi^2$','p'),
        digits=c(1,2,2,2),align='rrll',escape=FALSE)
```

```{r OpilioLinear, echo=FALSE, warning=FALSE}
opilLinTerms %>% select(-p) %>% 
  kable(.,caption='Trap location (cover type that trap was located in) intercept estimates for \\emph{Phalangium opilio}',col.names=c('Trap location','$\\beta$','S.E.','Z','p'),
        digits=c(1,2,2,2,2),align='rrrrl',escape=FALSE)
```

```{r OpilioSmooth, echo=FALSE, warning=FALSE}
opilSmTerms %>% select(-Ref.df,-p) %>% 
  kable(.,caption='Smooth terms for \\emph{Phalangium opilio}. \\emph{s} indicates a thin-plate spline, \\emph{ti} indicates a tensor-product interaction. All terms except for day and (E,N) are functional regression fits.',
        col.names=c('Smoothing term','E.d.f.','$\\chi^2$','p'),
        digits=c(1,2,2,2),align='rrll',escape=FALSE)
```

# References